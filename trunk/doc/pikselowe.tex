\chapter{Metody operuj¹ce na poziomie pikseli}
\label{cha:Metody operuj¹ce na poziomie pikseli}
Metody inicjalizacji modelu t³a dzia³aj¹ce na poziomie pikseli dzia³aj¹ na najmniejszych mo¿liwych czêœciach obrazu, czyli na pojedynczych pikselach. Metody te bior¹ pod uwagê jedynie wartoœæ piksela w danym miejscu obrazu bez zwracania uwagi na bezpoœrednie s¹siedztwo analizowanego elementu.
W~niniejszym rozdziale zostan¹ opisane 4 metody inicjalizacji t³a zaliczaj¹ce siê do tej grupy:
\begin{itemize}
\item Mixture of Gaussians (MOG)
\item Œrednia z bufora ramek
\item Aproksymacja œredniej przy u¿yciu parametru alfa
\item Mediana z bufora ramek
\end{itemize}
\section{Mixture of Gaussians (MOG)}
\subsection{Wprowadzenie}
T³o sceny zawiera wiele dynamicznych obiektów jak poruszane na wietrze ga³êzie i~liœcie drzew czy krzewów. Zmiany w~obrazie nimi wywo³ane powoduj¹, ¿e wartoœæ intensywnoœci danego piksela oraz jego kolor w~czasie mog¹ siê bardzo ró¿niæ od siebie. Z~tego powodu wykorzystanie pojedynczego przybli¿enia rozk³adu prawdopodobieñstwa przy u¿yciu krzywej Gaussa u¿yte w \cite{Wren1997} daje z³e rezultaty. Zamiast tego w~opisywanej metodzie u¿yto podejœcia bazuj¹cego na wykorzystaniu kilku rozk³adów Gaussa o~ró¿nych parametrach w~celu zamodelowania takich zmian \cite{7}.

%Standardowy adaptacyjny model t³a polega na tworzeniu aproksymacji t³a, które jest podobne do obecnej statycznej sceny za wyj¹tkiem miejsc, w~których odby³ siê ruch. Podejœcie takie jest efektywne w~sytuacjach, gdy obiekty poruszaj¹ siê nieustannie, a~t³o jest widoczne znaczn¹ czêœæ czasu, jednak¿e nie sprawdza siê ono dla scen zawieraj¹cych du¿o poruszaj¹cych siê obiektów, a~w szczególnoœci, gdy obiekty te poruszaj¹ siê powoli. Nie potrafi tak¿e poradziæ sobie z~t³ami posiadaj¹cymi rozk³ad dwumodalny (posiadaj¹cy 2 najczêœciej wystêpuj¹ce wartoœci), powoli odtwarza t³o jeœli zostanie ono odkryte i~ma jeden ustalony próg dla ca³ej sceny. 

W metodzie MOG zamiast modelowaæ wartoœci wszystkich pikseli jako wy³¹cznie jeden typ rozk³adu, modelowane s¹ one mieszank¹ rozk³adów Gaussa. Bazuj¹c na wadze i~wariancji ka¿dego u¿ytego do mieszanki rozk³adu Gaussa okreœlane jest, które z~nich mog¹ odnosiæ siê do pikseli t³a, a które do obiektów pierwszego planu. Wartoœci pikseli, które nie pasuj¹ do ¿adnego rozk³adu t³a uznawane s¹ za piksele nale¿¹ce do pierwszego planu. Taki stan pikseli utrzymuje siê do czasu kiedy zaczn¹ wystarczaj¹co dobrze pasowaæ do któregoœ z~rozk³adów t³a. 

Opisywana metoda dostosowuje siê tak, aby radziæ sobie ze zmianami oœwietlenia, powtarzalnymi ruchami elementów t³a, powolnie poruszaj¹cymi siê elementami pierwszego planu oraz wprowadzaniu lub usuwaniu elementów ze sceny. Powolnie poruszaj¹ce siê elementy potrzebuj¹ wiêcej czasu aby wpasowaæ siê w~t³o, poniewa¿ rozk³ad do którego pasuj¹ ma wiêksz¹ wariancjê ni¿ t³o. Powtarzaj¹ce siê zmiany równie¿ s¹ uwzglêdniane, a~model rozk³adu t³a jest utrzymywany nawet jeœli jest chwilowo zamieniony przez inny rozk³ad, co prowadzi do szybszego odtworzenia t³a w~przypadku usuniêcia obiektów ze sceny.
W wiêkszoœci implementacji tej metody inicjalizacja obrazu odbywa siê za pomoc¹ pierwszej ramki.
%Metoda ta wykorzystuje dwa podstawowe parametry: 
%\begin{lstlisting}
%a - sta³a uczenia
%T - porcja danych jaka powinna byæ uwzglêdniona w~tle
%\end{lstlisting}

%Zak³adaj¹c, ¿e ka¿dy piksel obrazu bêdzie pochodzi³ z~jednej p³aszczyzny przy zmiennym œwietleniu, to do wydzielenia t³a z~takiego obrazu wystarczy u¿ycie pojedynczej adaptacyjnej aproksymacji rozk³adem Gaussa dla ka¿dego piksela. Jednak¿e w~rzeczywistych warunkach na obrazie wystêpuje wiele powierzchni oraz zmienne oœwietlenie, co sprawia, ¿e potrzebne staje siê u¿ycie kilku adaptacyjnych rozk³adów Gaussa. W~opisywanej metodzie u¿yta jest mieszanka kilku takich rozk³adów o~ró¿nych parametrach. Za ka¿dym razem, gdy parametry rozk³adu s¹ aktualizowane, nastêpuje proces oceny dostêpnych rozk³adów w~celu okreœlenia tego najbardziej prawdopodobnego. 

\subsection{Opis metody}
\subsubsection{Model mieszanki}

Niech kolejne wartoœci danego piksela w~czasie nazywaj¹ siê histori¹ piksela. Zatem jest to ci¹g wartoœci danego piksela, gdzie dla obrazów w~skali szaroœci s¹ to wartoœci skalarne, a~dla obrazów kolorowych s¹ to wektory. O~danym pikselu $\{x_0,y_0\}$ w~danej chwili czasu t, mo¿na powiedzieæ, ¿e znana jest jego historia
\begin{equation}
\{X_1,\dots,X_t\}=\{I(x_0,y_0,i):1\le i \le t\}
\end{equation}
gdzie: $I$ jest sekwencj¹ ramek.

Niedawna historia dla ka¿dego piksela modelowana jest mieszank¹ K~rozk³adów Gaussa. Prawdopodobieñstwo zaobserwowania obecnego piksela okreœla siê wzorem

\begin{equation}
P(X_t)=\sum_{i=1}^{K} \omega_{i,t} \cdot \eta(X_t, \mu_{i,t} , \Sigma_{i,t})
\end{equation}

\noindent gdzie K~jest liczb¹ rozk³adów,  $\omega_{i,t}$ jest oszacowan¹ wag¹ $i$-tego rozk³adu w~mieszance w~chwili $t$, $\mu_{i,t}$ jest œredni¹ wartoœci¹  $i$-tego rozk³adu w~mieszance w~chwili $t$, $\Sigma_{i,t}$ jest macierz¹ kowariancji w~chwili $t$,$\eta$ jest funkcj¹ gêstoœci prawdopodobieñstwa Gaussa:

\begin{equation}
\eta(X_t,\mu,\Sigma)=\frac{1}{(2\pi)^\frac{n}{2} |\Sigma|^\frac{1}{2}}e^{-\frac{1}{2}(X_t-\mu_t)^T \Sigma^{-1} (W_t -\mu_t)}
\end{equation}

\noindent gdzie: K~okreœlane jest przez dostêpn¹ pamiêæ oraz moc obliczeniow¹ jednostki na której wykonywany jest algorytm. Najczêœciej spotykana wartoœæ mieœci siê w~zakresie od 3~do 5. W~celu zmniejszenia iloœci obliczeñ przyjmuje siê, ¿e macierz kowariancji ma postaæ:

\begin{equation}
\Sigma_{k,t}=\sigma^2_kI
\end{equation}

Takie rozwi¹zanie zak³ada, ¿e wartoœci dla poszczególnych sk³adowych barwnych ka¿dego piksela maj¹ tak¹ sam¹ wariancjê. Za³o¿enie to obci¹¿one jest pewnymi b³êdami, lecz pozwala unikn¹æ wykonywania operacji odwracania macierzy, co jest zadaniem bardzo kosztownym, za cenê mniejszej precyzji. 

Zatem rozk³ad ostatnio obserwowanych wartoœci dla ka¿dego piksela w~obrazie opisany jest mieszank¹ rozk³adów Gaussa. Nowa wartoœæ piksela bêdzie na ogó³ reprezentowana przez jeden z~g³ównych sk³adników mieszanki. 

Do obliczenia wartoœci nowego piksela u¿yta zosta³a metoda aproksymacji K œrednimi. Ka¿da wartoœæ piksela jest sprawdzana pod k¹tem dopasowania do jednego z~K rozk³adów. Obliczana jest odleg³oœæ piksela od ka¿dego z rozk³adów, zdefiniowana jako 2,5 odchylenia standardowego z~danego rozk³adu. Opisany sposób wyboru odpowiednich pikseli jest bardzo u¿yteczny dla obszarów z~ró¿nym oœwietleniem, poniewa¿ obiekty znajduj¹ce siê w~zacienionych obszarach maj¹ mniejszy szum ni¿ obiekty znajduj¹ce siê w~jaœniejszych regionach.

W przypadku, gdy ¿aden rozk³ad nie zosta³ dopasowany do danego piksela, to rozk³ad z~najmniejsz¹ wag¹ jest zastêpowany nowym z~wartoœci¹ piksela jako now¹ wartoœci¹ oczekiwan¹, du¿¹ wariancj¹ i~nisk¹ wag¹.

Wczeœniejsze wagi K~rozk³adów w~czasie t~s¹ aktualizowane wg wzoru: 

\begin{equation}
\omega_{k,t}=(1-\alpha)\omega_{k,t-1}+\alpha(M_{k,t})
\end{equation}
gdzie: $\alpha$ to tempo uczenia, a~$M_{k,t}$ jest 1~dla dopasowanego rozk³adu i~0 dla pozosta³ych rozk³adów. Po dokonaniu aproksymacji wagi s¹ normalizowane. $\frac{1}{\alpha}$ oznacza sta³¹ czasow¹ okreœlaj¹c¹ prêdkoœæ z~jak¹ parametry rozk³adów siê zmieniaj¹.

Dla rozk³adów niedopasowanych do danego piksela wartoœci $\mu$ i~$\sigma$ pozostaj¹ niezmienione. Dla rozk³adów, które zosta³y dopasowane wartoœci $\mu$ i~$\sigma$ obliczane s¹ nastêpuj¹co:

\begin{equation}
\mu_t=(1-\rho)\mu_{t-1}+\rho X_t
\end{equation}

\begin{equation}
\sigma^2_t=(1-\rho)\sigma^2_{t-1}+\rho(X_t-\mu_t)^T(X_t-\mu_t)
\end{equation}
przy czym:

\begin{equation}
\rho = \alpha\eta(X_t|\mu_k,\sigma_k)
\end{equation}

Jedn¹ z~najwiêkszych zalet opisanego rozwi¹zania jest fakt, ¿e kiedy jakiœ obiekt zostanie dodany do t³a, to nie niszczy on istniej¹cego modelu t³a. Oryginalny kolor t³a zostaje zachowany w~mieszance do czasu, a¿ stanie siê najmniej prawdopodobnym kandydatem oraz zostanie zaobserwowany nowy kolor. Zatem jeœli obiekt pozostanie nieruchomy wystarczaj¹co d³ugo aby staæ siê czêœci¹ t³a, a~nastêpnie siê poruszy, to rozk³ad opisuj¹cy poprzednie t³o ci¹gle istnieje w~tymi samymi $\mu$ i~$\sigma^2$, ale mniejszym $\omega$ przez co mo¿e zostaæ szybko ponownie do³¹czony do modelu t³a.

\subsubsection{Estymacja modelu t³a}


Podczas gdy parametry modelu mieszanki dla ka¿dego piksela zmieniaj¹ siê, nale¿y okreœliæ które rozk³ady z~mieszanki daj¹ najwiêksze prawdopodobieñstwo bycia wygenerowanymi przez procesy t³a. Z~heurystycznego punktu widzenia najbardziej interesuj¹ce s¹ rozk³ady, które daj¹ najlepsze dopasowanie i~najmniejsz¹ wariancjê


W celu wybrania odpowiednich rozk³adów nale¿y uszeregowaæ je wed³ug wartoœci $\omega$/$\sigma$. Wartoœæ ta roœnie zarówno przy zwiêkszeniu dopasowania, jak i~przy zmniejszeniu wariancji. W~praktyce tak uszeregowana lista daje zbiór rozk³adów, gdzie najbardziej prawdopodobni kandydaci znajduj¹ siê na pocz¹tku, a~najmniej prawdopodobni na koñcu.
Selekcji pierwszych rozk³adów do modelu t³a dokonuje siê za pomoc¹ wzoru 

\begin{equation}
B = argmin_b\left(\sum_{k=1}^{b}\omega_k>T\right)
\end{equation}
gdzie: T~jest miar¹ minimalnej iloœci danych jaka powinna byæ prana pod uwagê. Rozwi¹zanie takie bierze pod uwagê najlepiej dostosowany rozk³ad dot¹d, a¿ pewna porcja T~danych jest rozwa¿ona. Jeœli T~jest jest wartoœci¹ ma³¹, to wtedy model t³a zazwyczaj jest unimodalny. Jeœli T~jest wartoœci¹ wiêksz¹, multimodalny rozk³ad wywo³any powtarzalnymi ruchami w~tle mo¿e skutkowaæ uwzglêdnieniem w~modelu t³a wiêcej ni¿ jednego koloru. Rezultatem tego jest efekt przezroczystoœci, który pozwala modelowi przyjmowaæ dwa lub wiêcej oddzielnych kolorów. 


\section{Œrednia z~bufora ramek}
\subsection{Wprowadzenie}
Œrednia z~bufora ramek jest jedn¹ z~najprostszych mo¿liwych metod inicjalizacji t³a. W tej metodzie t³o inicjalizowane jest na podstawie ca³ego bufora ramek. Algorytm ten opiera siê na wyliczaniu œredniej arytmetycznej dla ka¿dej pozycji piksela na obrazie spoœród ramek zgromadzonych w~buforze.

\subsection{Opis metody}
Wartoœæ dla ka¿dego piksela t³a wyliczana jest ze wzoru.

\begin{equation}
B(x,y)=\frac{1}{n} \sum_{i=1}^{n} P(x_i,y_i)
\end{equation}

\noindent gdzie: $B(x,y)$ oznacza obecn¹ wartoœæ piksela t³a w~miejscu (x,y), $n$ oznacza rozmiar bufora, $P(x_i,y_i)$ oznacza wartoœæ piksela na pozycji (x,y) w~$i$-tej ramce w~buforze.


\section{Aproksymacja œredniej przy u¿yciu parametru alfa}
\subsection{Wprowadzenie}

Metoda ta jest modyfikacj¹ œredniej z~bufora ramek. Jej g³ównym za³o¿eniem jest aproksymacja œredniej za pomoc¹ morfingu ramek. Daje ona podobne rezultaty, jednak¿e w~przeciwieñstwie do swojego pierwowzoru nie wykorzystuje bufora, a przez to charakteryzuje siê mniejsz¹ z³o¿onoœci¹ pamiêciow¹. Inicjalizacja t³a przeprowadzana jest na podstawie pierwszej ramki.

\subsection{Opis metody}
Wartoœæ dla ka¿dego piksela t³a wyliczana jest ze wzoru:

\begin{equation}
\label{alpha}
B_{n}(x,y) = P_{n}(x,y) \cdot (1-\alpha) + B_{n-1}(x,y) \cdot \alpha
\end{equation}

\noindent gdzie: $B_{n}(x,y)$ oznacza obecn¹ wartoœæ piksela t³a w~miejscu (x,y), $P_{n}(x,y)$ oznacza wartoœæ piksela na pozycji (x,y) w~obecnej ramce, $B_{n-1}$ oznacza wartoœæ piksela t³a na pozycji (x,y) w~poprzedniej iteracji algorytmu.

\section{Mediana z bufora ramek}
\subsection{Wprowadzenie}

Mediana z~bufora ramek jest kolejn¹ z prostych metod inicjalizacji t³a. Do zainicjalizowania t³a u¿ywa ona ca³ego bufora ramek. Algorytm ten opiera siê na wyliczaniu mediany dla ka¿dej pozycji piksela na obrazie spoœród ramek zgromadzonych w~buforze.

\subsection{Opis metody}
Wartoœæ dla ka¿dego piksela t³a wyliczana jest ze wzoru.

\begin{equation}
\label{alpha}
B(x,y) = \widetilde{P(x,y)}, \; gdzie \;  P(x,y) = \{P_{1}(x,y), P_{2}(x,y), \dots , P_{n}(x,y)\}
\end{equation}

\noindent gdzie: $B(x,y)$ oznacza wartoœæ piksela t³a w~miejscu (x,y), $P(x,y)$ oznacza zbiór wartoœæ piksela na pozycji (x,y) we wszystkich ramkach w buforze, $\widetilde{P(x,y)}$ oznacza medianê (wartoœæ œrodkow¹) na pozycji (x,y) we wszystkich ramkach w buforze, $P_{i}(x,y)$ oznacza wartoœæ piksela na pozycji (x,y) \newline w $i$-tej ramce, gdzie $i \in \{1,2,\dots,n\}$.
